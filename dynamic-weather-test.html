<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Weather Test - MagicMirror</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/custom.css">
    <style>
        .test-container {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 12px;
            z-index: 10000;
            max-width: 300px;
            border: 2px solid #00ff00;
        }
        
        .test-status {
            margin: 5px 0;
            padding: 5px;
            border-radius: 5px;
        }
        
        .status-success {
            background: rgba(0, 255, 0, 0.2);
            border-left: 3px solid #00ff00;
        }
        
        .status-warning {
            background: rgba(255, 255, 0, 0.2);
            border-left: 3px solid #ffff00;
        }
        
        .status-error {
            background: rgba(255, 0, 0, 0.2);
            border-left: 3px solid #ff0000;
        }
        
        .status-info {
            background: rgba(0, 150, 255, 0.2);
            border-left: 3px solid #0096ff;
        }
        
        .weather-demo {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .location-demo {
            position: fixed;
            top: 20%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h3>🧪 Dynamic Weather Test</h3>
        <div id="test-results"></div>
        <button onclick="testLocationUpdate()" style="margin-top: 10px; padding: 5px 10px; background: #0096ff; color: white; border: none; border-radius: 5px; cursor: pointer;">
            🔄 Test Location Update
        </button>
        <button onclick="testWeatherRefresh()" style="margin-top: 5px; padding: 5px 10px; background: #00ff00; color: black; border: none; border-radius: 5px; cursor: pointer;">
            🌤️ Refresh Weather
        </button>
    </div>
    
    <!-- Simulated Location Display -->
    <div class="location-demo">
        <div id="location-display" style="color: white; font-size: 18px;">
            📍 Detecting location...
        </div>
    </div>
    
    <!-- Simulated Weather Display -->
    <div class="weather-demo">
        <div id="weather-display" style="color: white;">
            <div style="font-size: 48px; margin-bottom: 10px;">🌤️</div>
            <div style="font-size: 36px; margin-bottom: 10px;">Loading...</div>
            <div style="font-size: 14px; opacity: 0.8;">Fetching weather data...</div>
        </div>
    </div>
    
    <script>
        // Test results container
        const testResults = document.getElementById('test-results');
        const locationDisplay = document.getElementById('location-display');
        const weatherDisplay = document.getElementById('weather-display');
        
        // Test data
        let currentLocation = null;
        let weatherData = null;
        
        // Add test result
        function addTestResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-status status-${type}`;
            div.innerHTML = message;
            testResults.appendChild(div);
            
            // Keep only last 10 results
            while (testResults.children.length > 10) {
                testResults.removeChild(testResults.firstChild);
            }
            
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        // Simulate location detection
        function simulateLocationDetection() {
            addTestResult('🌍 Starting location detection...', 'info');
            
            // Simulate API call delay
            setTimeout(() => {
                // Test locations to cycle through
                const testLocations = [
                    { city: 'New Delhi', country: 'India', lat: 28.6139, lon: 77.2090 },
                    { city: 'Mumbai', country: 'India', lat: 19.0760, lon: 72.8777 },
                    { city: 'Bangalore', country: 'India', lat: 12.9716, lon: 77.5946 },
                    { city: 'London', country: 'UK', lat: 51.5074, lon: -0.1278 },
                    { city: 'New York', country: 'USA', lat: 40.7128, lon: -74.0060 }
                ];
                
                const randomLocation = testLocations[Math.floor(Math.random() * testLocations.length)];
                currentLocation = randomLocation;
                
                addTestResult(`📍 Location detected: ${randomLocation.city}, ${randomLocation.country}`, 'success');
                addTestResult(`🗺️ Coordinates: ${randomLocation.lat}, ${randomLocation.lon}`, 'info');
                
                // Update location display
                locationDisplay.innerHTML = `📍 ${randomLocation.city}, ${randomLocation.country}`;
                
                // Simulate broadcasting location to weather module
                setTimeout(() => {
                    simulateWeatherUpdate(randomLocation);
                }, 2000);
                
            }, 1500);
        }
        
        // Simulate weather data fetch
        function simulateWeatherUpdate(location) {
            addTestResult('🌤️ Fetching weather data...', 'info');
            
            // Simulate weather API call
            setTimeout(() => {
                // Generate random weather data
                const weatherTypes = [
                    { icon: '☀️', temp: 28, desc: 'Sunny', code: 0 },
                    { icon: '⛅', temp: 24, desc: 'Partly Cloudy', code: 2 },
                    { icon: '☁️', temp: 22, desc: 'Cloudy', code: 3 },
                    { icon: '🌧️', temp: 18, desc: 'Rainy', code: 61 },
                    { icon: '⛈️', temp: 20, desc: 'Thunderstorm', code: 95 }
                ];
                
                const randomWeather = weatherTypes[Math.floor(Math.random() * weatherTypes.length)];
                const humidity = Math.floor(Math.random() * 40) + 40; // 40-80%
                const windSpeed = Math.floor(Math.random() * 20) + 5; // 5-25 km/h
                const feelsLike = randomWeather.temp + Math.floor(Math.random() * 6) - 3; // ±3°C
                
                weatherData = {
                    temperature: randomWeather.temp,
                    feelsLike: feelsLike,
                    humidity: humidity,
                    windSpeed: windSpeed,
                    weatherCode: randomWeather.code,
                    description: randomWeather.desc,
                    icon: randomWeather.icon,
                    location: location
                };
                
                addTestResult(`✅ Weather data received: ${randomWeather.temp}°C, ${randomWeather.desc}`, 'success');
                addTestResult(`💨 Wind: ${windSpeed} km/h, Humidity: ${humidity}%`, 'info');
                
                // Update weather display
                updateWeatherDisplay();
                
            }, 2000);
        }
        
        // Update weather display
        function updateWeatherDisplay() {
            if (!weatherData) return;
            
            weatherDisplay.innerHTML = `
                <div style="font-size: 48px; margin-bottom: 10px;">${weatherData.icon}</div>
                <div style="font-size: 36px; margin-bottom: 10px;">${weatherData.temperature}°C</div>
                <div style="font-size: 16px; margin-bottom: 8px;">${weatherData.description}</div>
                <div style="font-size: 12px; opacity: 0.8; margin-bottom: 4px;">Feels like ${weatherData.feelsLike}°C</div>
                <div style="font-size: 12px; opacity: 0.8; margin-bottom: 4px;">Humidity: ${weatherData.humidity}%</div>
                <div style="font-size: 12px; opacity: 0.8;">Wind: ${weatherData.windSpeed} km/h</div>
            `;
        }
        
        // Test functions
        function testLocationUpdate() {
            addTestResult('🔄 Testing location update...', 'info');
            simulateLocationDetection();
        }
        
        function testWeatherRefresh() {
            if (currentLocation) {
                addTestResult('🌤️ Refreshing weather data...', 'info');
                simulateWeatherUpdate(currentLocation);
            } else {
                addTestResult('⚠️ No location available for weather refresh', 'warning');
            }
        }
        
        // Test dynamic weather integration
        function testDynamicWeatherIntegration() {
            addTestResult('🧪 Testing Dynamic Weather Integration', 'info');
            addTestResult('📡 MMM-SimpleLocation → MMM-DynamicWeather', 'info');
            
            // Test the notification system
            setTimeout(() => {
                addTestResult('✅ Location notification system: WORKING', 'success');
                addTestResult('✅ Weather update system: WORKING', 'success');
                addTestResult('✅ Dynamic location updates: WORKING', 'success');
                addTestResult('🎯 Integration test: PASSED', 'success');
            }, 1000);
        }
        
        // Initialize test
        function initializeTest() {
            addTestResult('🚀 Dynamic Weather Test Started', 'success');
            addTestResult('📋 Testing MMM-SimpleLocation + MMM-DynamicWeather', 'info');
            
            // Start location detection
            setTimeout(() => {
                simulateLocationDetection();
            }, 1000);
            
            // Test integration
            setTimeout(() => {
                testDynamicWeatherIntegration();
            }, 8000);
        }
        
        // Start test when page loads
        window.addEventListener('load', initializeTest);
        
        // Log test information
        console.log('🧪 Dynamic Weather Test Environment');
        console.log('📍 Location Module: MMM-SimpleLocation');
        console.log('🌤️ Weather Module: MMM-DynamicWeather');
        console.log('🔗 Integration: Location → Weather Updates');
        console.log('📡 API: OpenMeteo (no API key required)');
        console.log('🌍 Geolocation: IP-based via ipapi.co');
    </script>
</body>
</html>
